#+TITLE: Auth Feature - Quick Reference
#+DATE: 2026-02-03

* Overview

Authentication via Supabase Auth with user profiles and multi-client support. Provides arcade-styled login UI, real auth state management, and client switching for StrideShift admins.

* Components

| Component | File | Purpose |
|-----------|------|---------|
| LoginCard | LoginCard.tsx:23 | Login form with email/password inputs and arcade styling |
| CombinedLogo | CombinedLogo.tsx:19 | Logo showing StrideShift Global + TenderRender |
| PixelBootLoader | PixelBootLoader.tsx:33 | Animated 10x10 pixel grid loader with reveal animation |

* Contexts & Hooks

| Item | File | Purpose |
|------|------|---------|
| AuthProvider | AuthContext.tsx:14 | Provider component wrapping app with Supabase auth |
| useAuth | AuthContext.tsx:236 | Hook to access auth state and methods |

* Types

| Type | File | Key Fields |
|------|------|-----------|
| AuthState | types.ts:17 | user, profile, clientCode, availableClients, isStrideShift, isAuthenticated, isLoading |
| AuthContextValue | types.ts:27 | AuthState + login(), logout(), setActiveClient(), updatePassword() |
| UserProfile | types.ts:9 | user_id, client_pk (nullable), display_name, role, is_strideshift |
| Client | types.ts:3 | client_pk, client_code, client_name |

* AuthProvider Methods

| Method | Signature | Behavior |
|--------|-----------|----------|
| login | (email: string, password: string) => Promise<void> | Sign in via Supabase Auth, fetch user profile and clients |
| logout | () => Promise<void> | Sign out via Supabase, clear all state and localStorage |
| setActiveClient | (clientCode: string) => void | Switch active client, validate against availableClients |
| updatePassword | (newPassword: string) => Promise<void> | Update user password via Supabase Auth |

* AuthProvider State

| Property | Type | Purpose |
|----------|------|---------|
| user | SupabaseUser \vert null | Raw Supabase user object from auth.getSession() |
| profile | UserProfile \vert null | User profile from user_profiles table |
| clientCode | string \vert null | Active client code for scoping queries |
| availableClients | Client[] | List of clients user has access to |
| isStrideShift | boolean | True if user.is_strideshift in profile |
| isAuthenticated | boolean | True after successful fetchUserData |
| isLoading | boolean | True during login or initial auth check |

* LoginCard Props

| Prop | Type | Required | Description |
|------|------|----------|-------------|
| onLogin | (username: string, password: string) => void | Yes | Called when form submitted |
| isLoading | boolean | Yes | Disables inputs, shows "LOGGING IN..." state |

* CombinedLogo Props

| Prop | Type | Required | Default | Description |
|------|------|----------|---------|-------------|
| size | 'medium' \vert 'large' \vert 'xlarge' | No | 'large' | Logo size |
| showPixelBoot | boolean | No | false | Show PixelBootLoader animation |

* PixelBootLoader Props

| Prop | Type | Required | Default | Description |
|------|------|----------|---------|-------------|
| size | 'small' \vert 'medium' \vert 'large' | No | 'medium' | Pixel size |
| color | string | No | '#2a9d8f' | Pixel color |

* Authentication Flow

1. AuthProvider checks for existing session on mount via supabase.auth.getSession()
2. If session exists, sets user and calls fetchUserData(userId)
3. fetchUserData fetches user_profiles row, checks is_strideshift flag
4. If StrideShift: fetches all active clients from clients table
5. If regular user: fetches their single client via client_pk
6. Sets clientCode from localStorage or defaults to first available client
7. onAuthStateChange listens for SIGNED_IN, SIGNED_OUT, TOKEN_REFRESHED events
8. login() calls supabase.auth.signInWithPassword() then fetchUserData()

* Client Switching (StrideShift Only)

- setActiveClient(newClientCode) validates client in availableClients
- Stores choice in localStorage at STORAGE_KEY='tenderrender_active_client'
- Regular users have single client, cannot switch
- StrideShift users see all active clients from clients table

* Theme Colors

| Color | Hex | Used For |
|-------|-----|----------|
| primary | #2a9d8f | Borders, logos, labels, primary text |
| accent | #e76f51 | Racing stripes, secondary highlights |
| bg | #faf8f5 | Page background |
| bgCard | #ffffff | Card background |
| textMuted | #6b7c8a | Secondary text, muted labels |
| text | #2d3436 | Primary text |
| border | #d4cfc5 | Input borders |

* Database Tables Accessed

| Table | Query Type | Purpose |
|-------|-----------|---------|
| user_profiles | SELECT by user_id | Fetch user profile, is_strideshift flag |
| clients | SELECT active by is_active or client_pk | Fetch available clients for user |

---
/Last Updated/: 2026-02-03
