#+TITLE: Dashboard Feature - Quick Reference
#+DATE: 2026-02-11

* Overview

Overview and monitoring feature. Displays stats, alerts, and recent activity for the client's tenders.

* Components

| Component | File | Purpose |
|-----------|------|---------|
| StatsGrid | components/StatsGrid.tsx:17 | Grid of six tender count cards with modern styling |
| StatCard | components/StatCard.tsx:11 | Single metric card with label and semantic color |
| AlertCard | components/AlertCard.tsx:24 | Alert indicator with severity-based left border |
| AlertsRow | components/AlertsRow.tsx:8 | Row showing briefings, closing deadlines, changes |
| RecentChanges | components/RecentChanges.tsx:7 | Displays 24h high-importance changes with status |
| TenderCarousel | components/TenderCarousel.tsx:10 | Auto-scrolling carousel with expand/collapse toggle |
| TenderCarouselCard | components/TenderCarouselCard.tsx:8 | Individual card with score, dates, LLM notes |
| ScoreDistributionChart | components/ScoreDistributionChart.tsx:17 | Recharts donut chart with center total label |
| DepartmentTreemap | components/DepartmentTreemap.tsx:56 | Recharts horizontal bar chart of tenders by dept |
| ClosingTimelineChart | components/ClosingTimelineChart.tsx:19 | Bar chart showing tenders closing by week (unused) |

* Hooks

| Hook | File | RPC Function | Purpose |
|------|------|--------------|---------|
| useDashboardStats | hooks/useDashboardStats.ts:10 | get_dashboard_stats | Fetches dashboard stats for current client |
| useRelevantTenders | hooks/useRelevantTenders.ts:22 | get_tenders_paginated | Fetches active, relevant tenders for carousel |
| useFilterOptions | @/features/tenders/hooks/useFilterOptions.ts:13 | get_filter_options | Fetches departments with counts for bar chart |

** useRelevantTenders Hook Parameters

The hook passes the following fixed parameters to get_tenders_paginated to ensure only active, not-yet-closed tenders appear:

| Parameter | Value | Purpose |
|-----------|-------|---------|
| p_is_relevant | true | Filter to relevant tenders only |
| p_status | 'active' | Explicitly filter by active status |
| p_min_days_until_close | 0 | Ensure closing_date >= NOW() (not yet closed) |
| p_sort_by | 'score' | Sort by relevance score (best first) |
| p_sort_desc | true | Descending order (highest scores first) |
| p_limit | limit parameter (default 12) | Control carousel display count |
| p_offset | 0 | Start from first result |

All other parameters (province_id, department_id, category_id, closing_from, closing_to, has_compulsory_briefing, search_text) are set to null to retrieve all relevant tenders without additional filtering.

Hook interface parameters:
| Parameter | Type | Default | Purpose |
|-----------|------|---------|---------|
| limit | number (optional) | 12 | Maximum tenders to fetch |

* RPC Function Usage

| Function Called | Used By | Purpose |
|-----------------|---------|---------|
| get_dashboard_stats | useDashboardStats | Fetch dashboard counts and metrics |
| get_tenders_paginated | useRelevantTenders | Fetch relevant tenders for carousel display |
| get_filter_options | useFilterOptions | Fetch department counts for treemap visualization |

* Stats Displayed

| Stat | Field Name | Description |
|------|------------|-------------|
| Total Active | total_active | All active tenders count |
| Relevant Tenders | total_relevant | Total tenders matching client criteria |
| Not Relevant | total_not_relevant | Filtered out tenders count |
| Excellent Fit | excellent_count | High priority tender count |
| Good Fit | good_count | Worth pursuing tender count |
| Worth Reviewing | worth_reviewing_count | Needs review tender count |

* Alert Types

| Alert | Field Name | Threshold | Purpose |
|-------|------------|-----------|---------|
| Briefings | briefings_next_7_days | >0 triggers urgent | Briefings due in next 7 days |
| Closing Soon | closing_next_7_days | >0 triggers urgent | Tenders closing in next 7 days |
| Recent Changes | high_importance_changes_24h | >0 triggers urgent | High-importance changes in last 24 hours |

* Component Features

** TenderCarousel

| Feature | Implementation |
|---------|----------------|
| Auto-scroll | 5000ms interval, configurable via autoScrollInterval prop |
| Pause behavior | Pauses on mouse hover, resumes on mouse leave |
| Responsive | 1 card (mobile), 2 cards (tablet), 3 cards (desktop) |
| Navigation | Prev/Next buttons and dot indicators in carousel mode |
| Data source | useRelevantTenders hook (default limit: 8, featured count) |
| Card navigation | Click card to navigate to /tenders/:tender_pk |
| View toggle | Button to switch between carousel and expanded grid |
| Grid mode | Shows all tenders in responsive grid (1/2/3 columns) |

** ScoreDistributionChart

| Feature | Implementation |
|---------|----------------|
| Chart type | Recharts donut chart (PieChart with innerRadius) |
| Data source | useDashboardStats hook |
| Categories | Excellent Fit (emerald), Good Fit (blue), Worth Reviewing (amber) |
| Labels | Percentage shown in center of segments if >5% |
| Legend | Custom legend with counts below chart |

** DepartmentTreemap

| Feature | Implementation |
|---------|----------------|
| Chart type | Recharts BarChart (horizontal layout) |
| Data source | useFilterOptions hook (departments with counts) |
| Display limit | Top 10 departments by count, then "Other" group |
| Colors | 10-color gold/amber palette, cycles through bars |
| Labels | Department name (Y-axis), count at end of bar |
| Height | Fixed 320px, scrollable if needed |

** StatCard Props

| Prop | Type | Purpose |
|------|------|---------|
| label | string | Metric label text |
| value | number or string | Metric value in serif font |
| featured | boolean (optional) | Adds gradient border and bg if true (default: false) |

* Dashboard Page Layout

DashboardPage.tsx displays components in this order:
1. StatsGrid + AlertsRow (flex row on large screens)
2. TenderCarousel (auto-scrolling carousel or expanded grid)
3. ScoreDistributionChart + DepartmentTreemap (side-by-side on desktop)
4. RecentChanges (activity status card)

Note: ClosingTimelineChart component exists but is not currently integrated in DashboardPage.

---
/Last Updated/: 2026-02-11
