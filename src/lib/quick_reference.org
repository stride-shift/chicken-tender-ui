#+TITLE: Lib, Pages, Hooks & Contexts - Quick Reference
#+DATE: 2026-02-11

* Overview

Core utilities, type definitions, page components, global hooks, and React contexts.

* Lib (=lib/=)

** Supabase Client

| File | Purpose |
|------|---------|
| supabase.ts:12 | Exports configured Supabase client instance |

*** Configuration

| Line | Details |
|------|---------|
| supabase.ts:3-4 | Reads VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY |
| supabase.ts:6-10 | Throws error if environment variables missing |
| supabase.ts:12 | Creates Supabase client with URL and anon key |

** Types

| File | Purpose |
|------|---------|
| types.ts | TypeScript interfaces for all RPC responses |

*** Key Type Definitions

| Type | Line | Purpose |
|------|------|---------|
| Recommendation | types.ts:2 | Enum for tender recommendation levels |
| Importance | types.ts:3 | Enum for change importance (high/medium/low) |
| TenderStatus | types.ts:4 | Enum for tender lifecycle status |
| ChangeType | types.ts:5 | Enum for change type (metadata/document) |
| LifecycleStatus | types.ts:6 | Enum for tender lifecycle stage (new/under_review/shortlisted/declined/watching) |
| DashboardStats | types.ts:8 | Dashboard metrics from get_dashboard_stats RPC |
| TenderListItem | types.ts:21 | Paginated tender list with llm_notes field |
| TenderDetail | types.ts:52 | Full tender detail from get_tender_detail |
| KnockoutResultValue | types.ts:103 | Evaluation knockout answer with reason |
| CriteriaResultValue | types.ts:109 | Evaluation criteria answer with evidence |
| TenderDocument | types.ts:115 | Document metadata and download info |
| DocumentChange | types.ts:128 | Document in change history (file_name, source_document_id) |
| TenderChange | types.ts:134 | Change history with importance and details |
| FieldChange | types.ts:155 | Individual field change in change history |
| FilterOptions | types.ts:164 | Province/department/category filter options |
| FilterOption | types.ts:170 | Individual filter option with count |
| ActivityItem | types.ts:177 | Activity feed item from get_activity_feed |
| ClientRubric | types.ts:191 | Full rubric from get_client_rubric |
| RubricKnockout | types.ts:205 | Knockout question in rubric |
| RubricCriterion | types.ts:211 | Scoring criterion in rubric |
| ThresholdRange | types.ts:219 | Score threshold range for recommendations |
| ScoringConfig | types.ts:225 | Rubric scoring configuration |

* Pages (=pages/=)

| Page | File | Route | Purpose |
|------|------|-------|---------|
| DashboardPage | DashboardPage.tsx:9 | / | Renders StatsGrid, AlertsRow, charts, TenderCarousel |
| TendersPage | TendersPage.tsx:6 | /tenders, /tenders/:tenderId | Tender list and detail side-by-side |
| RubricPage | RubricPage.tsx:4 | /rubric | Displays active client evaluation rubric |
| LoginPage | LoginPage.tsx:7 | /login | Login with forgot-password modal |
| ResetPasswordPage | ResetPasswordPage.tsx:6 | /reset-password | Handles Supabase magic link reset |

*** Page Details

| Page | Lines | Details |
|------|-------|---------|
| DashboardPage | 10-15 | Renders StatsGrid and AlertsRow in flex layout |
| DashboardPage | 19-22 | Renders ScoreDistributionChart + DepartmentTreemap grid |
| DashboardPage | 25 | Renders TenderCarousel component |
| TendersPage | 6-14 | Parses tenderId param, creates selectedTenderId state |
| TendersPage | 16-23 | handleSelectTender auto-collapses sidebar first time |
| TendersPage | 25-35 | Two-panel grid layout with list and detail panels |
| RubricPage | 4-5 | Uses useActiveClientRubric hook for data |
| RubricPage | 70-72 | Calls ensureArray to parse JSONB arrays safely |
| RubricPage | 307-318 | ensureArray helper handles JSONB parsing |
| RubricPage | 118-139 | Renders knockout criteria section with styled header |
| RubricPage | 142-164 | Renders scoring criteria section with weights |
| RubricPage | 167-207 | Renders recommendation threshold ranges |
| LoginPage | 15-33 | handleLogin callback with error handling |
| LoginPage | 35-40 | handleForgotPassword callback triggers modal |
| LoginPage | 42-54 | Renders LoginCard and error display |
| LoginPage | 57-61 | Renders ForgotPasswordModal component |

* Global Hooks (=hooks/=)

| Hook | File | Purpose |
|------|------|---------|
| useToast | useToast.ts:1 | Re-exports useToastContext and toast types |

* Contexts (=contexts/=)

| Context | File | Purpose |
|---------|------|---------|
| ToastContext | ToastContext.tsx:17 | Provides toast state and methods |

*** ToastContext Details

| Export | Line | Purpose |
|--------|------|---------|
| ToastType | ToastContext.tsx:3 | Type for success/error/info toast types |
| Toast | ToastContext.tsx:5-9 | Toast object with id, message, type |
| ToastProvider | ToastContext.tsx:19-60 | Provider component wrapping app |
| useToastContext | ToastContext.tsx:62-66 | Hook to access toast context |
| addToast | ToastContext.tsx:42-53 | Adds toast, auto-removes after 5000ms |
| removeToast | ToastContext.tsx:32-40 | Manually removes toast by id |

* App Entry Points

| File | Purpose |
|------|---------|
| App.tsx:37 | Root component with routing and providers |
| main.tsx:18 | Application entry point with React render |

*** App.tsx Details

| Line | Details |
|------|---------|
| 1-9 | Imports: React, Router, Auth, components |
| 11-15 | Lazy-loaded pages: Dashboard, Tenders, Rubric, ResetPassword |
| 17-32 | ProtectedRoute wrapper checks isAuthenticated |
| 37-73 | App function wraps app in ToastProvider → SidebarProvider → ErrorBoundary |
| 43-67 | Routes with Suspense fallback |
| 45 | Route: /login → LoginPage (outside AppShell) |
| 48 | Route: /reset-password → ResetPasswordPage (outside AppShell) |
| 51-65 | Wraps protected routes in ProtectedRoute + AppShell |
| 57 | Route: / → DashboardPage |
| 58 | Route: /tenders → TendersPage |
| 59 | Route: /tenders/:tenderId → TendersPage |
| 60 | Route: /rubric → RubricPage |
| 61 | Route: * → Redirect to / |
| 70 | Renders Toaster outside SidebarProvider |

*** main.tsx Details

| Line | Details |
|------|---------|
| 1-8 | Imports: React, ReactDOM, TanStack Query, Router, Auth |
| 9-16 | Creates QueryClient with 5-min staleTime, disables refetch on focus |
| 18-28 | Renders app in StrictMode with Provider chain |
| 19 | Wraps in StrictMode |
| 20 | Wraps in QueryClientProvider |
| 21 | Wraps in AuthProvider |
| 22 | Wraps in BrowserRouter |
| 23 | Renders App component |

* Routing

React Router v6 setup with nested routes and URL parameters.

| Route | Component | Params | Purpose |
|-------|-----------|--------|---------|
| /login | LoginPage | - | Login screen (no AppShell) |
| /reset-password | ResetPasswordPage | - | Password reset via Supabase callback |
| / | DashboardPage | - | Dashboard overview |
| /tenders | TendersPage | - | Tender list without selection |
| /tenders/:tenderId | TendersPage | tenderId: number | Tender list with detail panel |
| /rubric | RubricPage | - | Display evaluation rubric |
| * | Navigate to / | - | Catch-all redirect |

* Environment Variables

| Variable | Used By | Purpose |
|----------|---------|---------|
| VITE_SUPABASE_URL | supabase.ts:3 | Supabase project URL |
| VITE_SUPABASE_ANON_KEY | supabase.ts:4 | Supabase anonymous key |

---
/Last Updated/: 2026-02-11
